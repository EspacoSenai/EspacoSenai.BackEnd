<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Catálogos para Ambientes - Visual</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { max-width: 800px; margin: auto; }
        label { display: block; margin-top: 10px; }
        select { width: 100%; padding: 8px; margin-top: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: center; vertical-align: top; }
        th { background-color: #f2f2f2; }
        input[type="time"] { width: 100px; }
        button { margin-top: 20px; padding: 10px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        .disponibilidade { margin-top: 5px; }
        .horarios { margin-top: 10px; }
        .horario { display: flex; justify-content: space-around; align-items: center; margin-bottom: 5px; }
        .horario input, .horario select { margin: 0 5px; }
        .remover-horario { background-color: #f44336; color: white; border: none; padding: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Criar Catálogos para Ambientes - Visual por Dia e Horário</h1>
    <form id="formCatalogo">
        <label for="ambiente">Selecione o Ambiente:</label>
        <select id="ambiente" required>
            <option value="">Carregando...</option>
        </select>

        <table>
            <thead>
                <tr>
                    <th>Dia da Semana</th>
                    <th>Horários Disponíveis</th>
                </tr>
            </thead>
            <tbody id="diasTable">
                <!-- Linhas dos dias serão adicionadas aqui -->
            </tbody>
        </table>

        <button type="submit">Salvar Catálogos</button>
    </form>

    <script>
        const baseUrl = 'http://localhost:8080'; // Ajuste conforme necessário
        let ambientes = [];
        const dias = [
            { value: 'SEGUNDA', label: 'Segunda-feira' },
            { value: 'TERCA', label: 'Terça-feira' },
            { value: 'QUARTA', label: 'Quarta-feira' },
            { value: 'QUINTA', label: 'Quinta-feira' },
            { value: 'SEXTA', label: 'Sexta-feira' },
            { value: 'SABADO', label: 'Sábado' },
            { value: 'DOMINGO', label: 'Domingo' }
        ];

        // Carregar ambientes (mock data para exemplo)
        function loadAmbientes() {
            // Mock data
            ambientes = [
                { id: 1, nome: 'Sala 101' },
                { id: 2, nome: 'Laboratório de Informática' },
                { id: 3, nome: 'Auditório' }
            ];
            const select = document.getElementById('ambiente');
            select.innerHTML = '<option value="">Selecione um ambiente</option>';
            ambientes.forEach(ambiente => {
                const option = document.createElement('option');
                option.value = ambiente.id;
                option.textContent = ambiente.nome;
                select.appendChild(option);
            });
        }

        // Carregar dias
        function loadDias() {
            const tbody = document.getElementById('diasTable');
            dias.forEach(dia => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${dia.label}</td>
                    <td>
                        <div class="horarios">
                            <div class="horario">
                                <input type="time" name="horaInicio_${dia.value}[]" value="08:00">
                                <input type="time" name="horaFim_${dia.value}[]" value="18:00">
                                <select name="disponibilidade_${dia.value}[]" class="disponibilidade">
                                    <option value="DISPONIVEL">Disponível</option>
                                    <option value="INDISPONIVEL">Indisponível</option>
                                </select>
                                <button type="button" class="remover-horario" onclick="removerHorario(this)">Remover</button>
                            </div>
                        </div>
                        <button type="button" onclick="adicionarHorario('${dia.value}')">Adicionar Horário</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function adicionarHorario(dia) {
            const horariosDiv = document.querySelector(`[name="horaInicio_${dia}[]"]`).closest('td').querySelector('.horarios');
            const novoHorario = document.createElement('div');
            novoHorario.className = 'horario';
            novoHorario.innerHTML = `
                <input type="time" name="horaInicio_${dia}[]" value="08:00">
                <input type="time" name="horaFim_${dia}[]" value="18:00">
                <select name="disponibilidade_${dia}[]" class="disponibilidade">
                    <option value="DISPONIVEL">Disponível</option>
                    <option value="INDISPONIVEL">Indisponível</option>
                </select>
                <button type="button" class="remover-horario" onclick="removerHorario(this)">Remover</button>
            `;
            horariosDiv.appendChild(novoHorario);
        }

        function removerHorario(button) {
            const horarioDiv = button.closest('.horario');
            horarioDiv.parentNode.removeChild(horarioDiv);
        }

        // Inicializar
        loadAmbientes();
        loadDias();

        document.getElementById('formCatalogo').addEventListener('submit', function(e) {
            e.preventDefault();
            const ambienteId = document.getElementById('ambiente').value;
            if (!ambienteId) {
                alert('Selecione um ambiente.');
                return;
            }
            const catalogos = [];
            dias.forEach(dia => {
                const horariosInicio = document.getElementsByName(`horaInicio_${dia.value}[]`);
                const horariosFim = document.getElementsByName(`horaFim_${dia.value}[]`);
                const disponibilidades = document.getElementsByName(`disponibilidade_${dia.value}[]`);
                for (let i = 0; i < horariosInicio.length; i++) {
                    const horaInicio = horariosInicio[i].value;
                    const horaFim = horariosFim[i].value;
                    const disponibilidade = disponibilidades[i].value;
                    if (horaInicio && horaFim) {
                        catalogos.push({
                            idAmbiente: parseInt(ambienteId),
                            diaSemana: dia.value,
                            horaInicio: horaInicio,
                            horaFim: horaFim,
                            disponibilidade: disponibilidade
                        });
                    }
                }
            });
            if (catalogos.length === 0) {
                alert('Configure pelo menos um catálogo.');
                return;
            }

            console.log('Dados a enviar:', catalogos); // Para debug
            // fetch(`${baseUrl}/catalogo/salvar/${ambienteId}`, {
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json',
            //         'Authorization': 'Bearer ' + getToken()
            //     },
            //     body: JSON.stringify(catalogos)
            // })
            // .then(response => {
            //     if (response.ok) {
            //         alert('Catálogos salvos com sucesso!');
            //     } else {
            //         alert('Erro ao salvar catálogos.');
            //     }
            // })
            // .catch(error => console.error('Erro:', error));

            alert('Simulação: Catálogos salvos (dados no console).');
        });

        function getToken() {
            return localStorage.getItem('token') || 'seu-token-aqui';
        }
    </script>
</body>
</html>
